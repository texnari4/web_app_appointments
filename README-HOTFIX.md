# Hotfix: break the `prisma db push` restart loop on Railway (v2.3.6)

**Что исправлено**
- Контейнер больше не зацикливается на `prisma db push`.
- По умолчанию при старте выполняется только **безопасная** команда `prisma migrate deploy`.
- `prisma db push` теперь **опционален** и управляется переменными окружения.

## Как использовать
1. Замените `docker/entrypoint.sh` и `Dockerfile` файлами из этого архива.
2. Сделайте новый деплой.

## Управление `prisma db push`
По умолчанию `db push` выключен (рекомендуется для production).  
Чтобы включить:
- `PRISMA_DB_PUSH=1` — запустить `prisma db push`
- `PRISMA_DB_PUSH_ACCEPT_DATA_LOSS=1` — добавить флаг `--accept-data-loss`

> ⚠️ **Внимание**: `db push` может удалять/изменять таблицы. Используйте **только осознанно** или на dev/staging.

## Рекомендуемый флоу миграций
В локальной среде:
```bash
npx prisma migrate dev --name <change>
git commit -am "feat(db): <change>"
```

В проде (Railway):
- на старте контейнера выполняется `npx prisma migrate deploy` (безопасно применяет уже сгенерированные миграции).

Если в БД осталась старая таблица (`Service`) и вы убрали модель из `schema.prisma`, лучше:
- создать миграцию, которая аккуратно переносит/переименовывает данные, _или_
- временно оставить модель, пометив её `@@map("Service")`, а затем мигрировать данные и удалить модель в следующем релизе.
