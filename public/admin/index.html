
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin • Masters</title>
  <style>
    :root{--bg:#0b0b0c;--card:#141416;--muted:#8a8a8a;--txt:#fff;--accent:#0a84ff;--ok:#30d158;--danger:#ff453a;}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--txt);font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,system-ui,sans-serif}
    header{padding:16px 20px;border-bottom:1px solid #222;position:sticky;top:0;background:rgba(11,11,12,.75);backdrop-filter:saturate(180%) blur(16px)}
    h1{margin:0;font-size:18px;font-weight:600;letter-spacing:.2px}
    main{padding:20px;max-width:900px;margin:0 auto}
    .card{background:var(--card);border:1px solid #222;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35);overflow:hidden}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f10;color:var(--txt);outline:none}
    input:focus{border-color:var(--accent)}
    .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:8px}
    button{border:0;border-radius:999px;padding:10px 16px;cursor:pointer;font-weight:600}
    .primary{background:var(--accent);color:white}
    .ghost{background:#1a1a1b;color:var(--txt)}
    .danger{background:var(--danger);color:white}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 14px;border-bottom:1px solid #232323;text-align:left}
    tr:hover{background:#151516}
    .pill{padding:4px 10px;border-radius:999px;border:1px solid #2a2a2a;background:#101011;color:#cfcfcf;font-size:12px}
    .empty{padding:24px;color:#9a9a9a;text-align:center}
  </style>
</head>
<body>
  <header>
    <h1>Мастера</h1>
  </header>
  <main>
    <section class="card" style="padding:16px 16px 8px">
      <div class="row">
        <div>
          <label>Имя</label>
          <input id="name" placeholder="Например, Аня" />
        </div>
        <div>
          <label>Телефон</label>
          <input id="phone" placeholder="+7 ..."/>
        </div>
        <div>
          <label>Avatar URL</label>
          <input id="avatarUrl" placeholder="https://..." />
        </div>
        <div>
          <label>Статус</label>
          <select id="isActive" style="width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f10;color:var(--txt)">
            <option value="true">Активен</option>
            <option value="false">Скрыт</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button class="ghost" id="reset">Очистить</button>
        <button class="primary" id="save">Сохранить</button>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <div style="padding:12px 16px;border-bottom:1px solid #232323;font-weight:600">Список</div>
      <div id="list"></div>
    </section>
  </main>

  <script type="module">
    const API = '/public/api/masters';

    function el(html){const t=document.createElement('template');t.innerHTML=html.trim();return t.content.firstChild}

    async function load() {
      const wrap = document.getElementById('list');
      wrap.innerHTML = '<div class="empty">Загрузка...</div>';
      const res = await fetch(API);
      const items = await res.json();

      if (!Array.isArray(items) || !items.length) {
        wrap.innerHTML = '<div class="empty">Пока пусто</div>';
        return;
      }

      const table = el(`<table>
        <thead><tr><th>Имя</th><th>Телефон</th><th>Статус</th><th></th></tr></thead>
        <tbody></tbody>
      </table>`);
      const tb = table.querySelector('tbody');

      for (const m of items) {
        const tr = el(`<tr>
          <td>${m.name ?? ''}</td>
          <td>${m.phone ?? ''}</td>
          <td><span class="pill">${m.isActive ? 'Активен' : 'Скрыт'}</span></td>
          <td style="text-align:right">
            <button class="ghost" data-id="${m.id}" data-act="${m.isActive ? 'deactivate' : 'activate'}">${m.isActive ? 'Скрыть' : 'Включить'}</button>
            <button class="danger" data-id="${m.id}" data-act="delete">Удалить</button>
          </td>
        </tr>`);
        tb.appendChild(tr);
      }
      wrap.innerHTML = '';
      wrap.appendChild(table);

      // actions
      wrap.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.getAttribute('data-id');
          const act = btn.getAttribute('data-act');
          if (act === 'delete') {
            await fetch(`${API}/${id}`, { method: 'DELETE' });
          } else {
            const isActive = act === 'activate';
            await fetch(`${API}/${id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ isActive }),
            });
          }
          await load();
        });
      });
    }

    document.getElementById('reset').addEventListener('click', () => {
      ['name','phone','avatarUrl'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('isActive').value = 'true';
    });

    document.getElementById('save').addEventListener('click', async () => {
      const payload = {
        name: document.getElementById('name').value.trim(),
        phone: document.getElementById('phone').value.trim() || undefined,
        avatarUrl: document.getElementById('avatarUrl').value.trim() || undefined,
        isActive: document.getElementById('isActive').value === 'true',
      };
      const res = await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (res.ok) {
        document.getElementById('reset').click();
        await load();
      } else {
        const err = await res.json().catch(()=>({error:'Ошибка'}));
        alert('Ошибка: ' + (err.error || res.status));
      }
    });

    load();
  </script>
</body>
</html>
