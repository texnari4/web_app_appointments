<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin · Masters</title>
  <style>
    :root { color-scheme: dark light; }
    body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Inter, system-ui, Roboto, "Helvetica Neue", Arial, sans-serif; background:#0b0b0c; color:#f5f5f7; }
    header { position:sticky; top:0; backdrop-filter:saturate(180%) blur(20px); background:rgba(15,15,17,.7); border-bottom:1px solid rgba(255,255,255,.06); padding:14px 20px; }
    h1 { margin:0; font-size:18px; letter-spacing:.2px; }
    main { max-width:840px; margin:24px auto; padding:0 16px; }
    .card { background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:16px; box-shadow: 0 5px 25px rgba(0,0,0,.25); }
    label { display:block; font-size:12px; opacity:.8; margin-bottom:6px; }
    input { width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:#fff; outline:none; }
    input:focus { border-color:#7eb6ff; box-shadow:0 0 0 4px rgba(126,182,255,.12); }
    .row { display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
    .actions { display:flex; gap:10px; margin-top:12px; }
    button { appearance:none; border:0; padding:10px 14px; border-radius:12px; background:#2f81f7; color:#fff; font-weight:600; cursor:pointer; transition:transform .08s ease; }
    button:hover { transform: translateY(-1px); }
    table { width:100%; border-collapse: collapse; margin-top:16px; font-size:14px; }
    th, td { padding:10px 8px; border-bottom:1px solid rgba(255,255,255,.06); }
    th { text-align:left; opacity:.7; font-weight:500; }
    td .del { color:#ff7b7b; background:transparent; border:1px solid rgba(255,255,255,.12); }
    .empty { opacity:.7; padding:16px 4px; }
    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background:#16161a; border:1px solid rgba(255,255,255,.1); color:#fff; padding:10px 14px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,.25); display:none;}
    .toast.show { display:block; }
  </style>
</head>
<body>
  <header><h1>Управление мастерами</h1></header>
  <main>
    <section class="card">
      <div class="row">
        <div>
          <label>Имя мастера</label>
          <input id="name" placeholder="Например, Анна"/>
        </div>
        <div>
          <label>Телефон (опционально)</label>
          <input id="phone" placeholder="+7 999 000-00-00"/>
        </div>
      </div>
      <div class="actions">
        <button id="create">Сохранить</button>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <table>
        <thead>
          <tr><th>Имя</th><th>Телефон</th><th>Создан</th><th></th></tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
      <div class="empty" id="empty" style="display:none">Нет записей</div>
    </section>
  </main>
  <div class="toast" id="toast"></div>
  <script>
    const $ = sel => document.querySelector(sel);
    const list = $('#list');
    const empty = $('#empty');
    const toast = $('#toast');

    function showToast(text) {
      toast.textContent = text;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1800);
    }

    async function fetchList() {
      const res = await fetch('/admin/api/masters');
      const data = await res.json();
      list.innerHTML = '';
      if (!data.items || data.items.length === 0) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      for (const m of data.items) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>\${m.name}</td>
          <td>\${m.phone ?? ''}</td>
          <td>\${new Date(m.createdAt).toLocaleString()}</td>
          <td style="text-align:right"><button class="del" data-id="\${m.id}">Удалить</button></td>
        `;
        list.appendChild(tr);
      }
      list.querySelectorAll('.del').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.getAttribute('data-id');
          const res = await fetch('/admin/api/masters/' + id, { method:'DELETE' });
          if (res.ok) {
            showToast('Удалено');
            fetchList();
          } else {
            showToast('Ошибка удаления');
          }
        });
      });
    }

    $('#create').addEventListener('click', async () => {
      const name = $('#name').value.trim();
      const phone = $('#phone').value.trim();
      const res = await fetch('/admin/api/masters', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, phone })
      });
      if (res.ok) {
        $('#name').value = '';
        $('#phone').value = '';
        showToast('Сохранено');
        fetchList();
      } else {
        const err = await res.json().catch(() => ({}));
        showToast('Ошибка: ' + (err.error || res.status));
      }
    });

    fetchList();
  </script>
</body>
</html>
