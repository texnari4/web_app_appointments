<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Admin • Appointments</title>
    <style>
      body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; color: #0b0b0b; }
      .card { border: 1px solid #e5e5ea; border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.04); }
      input, button { font-size: 16px; padding: 10px 12px; border-radius: 12px; border: 1px solid #d1d1d6; outline: none; }
      input:focus { border-color: #007aff; box-shadow: 0 0 0 3px rgba(0,122,255,.15); }
      button { background: #0a84ff; color: white; border: none; }
      button:disabled { opacity: .5; }
      ul { list-style: none; padding-left: 0; }
      li { padding: 8px 0; border-bottom: 1px solid #f2f2f7; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
    </style>
  </head>
  <body>
    <h1>Admin</h1>

    <div class="card">
      <h3>Create master</h3>
      <div class="row">
        <input id="name" placeholder="Name"/>
        <input id="phone" placeholder="Phone"/>
      </div>
      <div class="row">
        <input id="about" placeholder="About"/>
        <input id="avatarUrl" placeholder="Avatar URL"/>
      </div>
      <button id="create">Create</button>
      <span id="msg"></span>
    </div>

    <div class="card">
      <h3>Masters</h3>
      <ul id="list"></ul>
    </div>

    <script>
      async function reload() {
        const r = await fetch('/public/api/masters');
        const j = await r.json();
        const list = document.getElementById('list');
        list.innerHTML = '';
        (j.data || []).forEach(m => {
          const li = document.createElement('li');
          li.textContent = m.name + (m.phone ? ' • ' + m.phone : '');
          list.appendChild(li);
        });
      }
      document.getElementById('create').addEventListener('click', async () => {
        const btn = document.getElementById('create');
        const msg = document.getElementById('msg');
        btn.disabled = true; msg.textContent = '...';
        try {
          const body = {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            about: document.getElementById('about').value,
            avatarUrl: document.getElementById('avatarUrl').value
          };
          const r = await fetch('/admin/api/masters', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body) });
          const j = await r.json();
          if (!j.ok) throw new Error(j.error || 'Failed');
          msg.textContent = '✓ created';
          await reload();
        } catch (e) {
          msg.textContent = 'Error: ' + e.message;
        } finally {
          btn.disabled = false;
        }
      });
      reload();
    </script>
  </body>
</html>
