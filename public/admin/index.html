<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ú–∞—Å—Ç–µ—Ä–∞</title>
  <style>
    :root { --bg:#0b0b0c; --card:#141416; --muted:#9aa0a6; --text:#e6e9ee; --accent:#0a84ff; --good:#32d74b; --bad:#ff453a; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "Inter", Arial; background: var(--bg); color: var(--text); }
    header { padding: 20px clamp(16px, 4vw, 40px); display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #222; position:sticky; top:0; backdrop-filter:saturate(180%) blur(10px); background:rgba(11,11,12,0.6); }
    h1 { font-size: 18px; margin:0; letter-spacing: .2px; }
    main { padding: 24px clamp(16px, 4vw, 40px); display:grid; grid-template-columns: 380px 1fr; gap:24px; align-items:start; }
    .card { background: var(--card); border:1px solid #222; border-radius: 18px; padding: 16px; box-shadow: 0 4px 20px rgba(0,0,0,.3); }
    .card h2 { margin: 0 0 12px; font-size: 16px; font-weight:600; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom:6px; }
    input[type="text"], input[type="tel"], input[type="url"] { width:100%; background:#0f0f11; border:1px solid #2a2a2e; color:var(--text); border-radius: 12px; padding: 10px 12px; outline:none; transition:border .2s; }
    input:focus { border-color: var(--accent); }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .switch { display:flex; align-items:center; gap:10px; margin-top:10px; }
    .switch input { transform: scale(1.1); }
    button { -webkit-appearance:none; appearance:none; background:var(--accent); color:white; border:none; border-radius:14px; padding:10px 14px; font-weight:600; cursor:pointer; transition: transform .06s ease, box-shadow .2s; box-shadow: 0 6px 18px rgba(10,132,255,.35); }
    button:active { transform: scale(.98); }
    .list { display:grid; gap:12px; }
    .item { display:flex; align-items:center; justify-content:space-between; gap:12px; background:#0f0f11; border:1px solid #29292d; padding:12px; border-radius:14px; }
    .meta { display:flex; align-items:center; gap:12px; }
    .avatar { width:40px; height:40px; border-radius:12px; background:#1b1b1d; object-fit:cover; }
    .name { font-weight:600; }
    .muted { color:var(--muted); font-size:12px; }
    .pill { font-size:11px; padding:6px 8px; border-radius:999px; border:1px solid #2b2b2f; }
    .pill.good { border-color:#214d2a; background:#0f2013; color:#5cf077; }
    .pill.bad { border-color:#4d2121; background:#201010; color:#ff7b75; }
    .actions { display:flex; align-items:center; gap:8px; }
    .danger { background:var(--bad); box-shadow: 0 6px 18px rgba(255,69,58,.25); }
    .empty { color:var(--muted); text-align:center; padding:24px; border:1px dashed #2a2a2e; border-radius:16px; }
    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>–ú–∞—Å—Ç–µ—Ä–∞</h1>
    <a href="/health" class="muted">health</a>
  </header>
  <main>
    <section class="card">
      <h2>–°–æ–∑–¥–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞</h2>
      <form id="form">
        <label>–ò–º—è</label>
        <input type="text" name="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–Ω–∞" required />
        <div class="row">
          <div>
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" name="phone" placeholder="+7 999 123-45-67" />
          </div>
          <div>
            <label>Avatar URL</label>
            <input type="url" name="avatarUrl" placeholder="https://..." />
          </div>
        </div>
        <div class="switch">
          <input type="checkbox" id="isActive" name="isActive" checked />
          <label for="isActive">–ê–∫—Ç–∏–≤–µ–Ω</label>
        </div>
        <div style="margin-top:12px; display:flex; gap:8px;">
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" id="reset">–°–±—Ä–æ—Å</button>
        </div>
        <p id="status" class="muted" style="margin-top:8px;"></p>
      </form>
    </section>

    <section class="card">
      <h2>–°–ø–∏—Å–æ–∫ –º–∞—Å—Ç–µ—Ä–æ–≤</h2>
      <div id="list" class="list"></div>
    </section>
  </main>

  <template id="item-tpl">
    <div class="item">
      <div class="meta">
        <img class="avatar" />
        <div>
          <div class="name"></div>
          <div class="muted phone"></div>
        </div>
      </div>
      <div class="actions">
        <span class="pill state"></span>
        <button class="danger del">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </template>

  <script>
    const API = '/public/api/masters';
    const listEl = document.getElementById('list');
    const form = document.getElementById('form');
    const statusEl = document.getElementById('status');
    const resetBtn = document.getElementById('reset');

    async function fetchList() {
      listEl.innerHTML = '<div class="empty">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';
      try {
        const r = await fetch(API, { cache: 'no-store' });
        const data = await r.json();
        renderList(data.items || []);
      } catch (e) {
        listEl.innerHTML = '<div class="empty">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
      }
    }

    function renderList(items) {
      if (!items.length) {
        listEl.innerHTML = '<div class="empty">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>';
        return;
      }
      listEl.innerHTML = '';
      for (const m of items) {
        const tpl = document.getElementById('item-tpl');
        const node = tpl.content.firstElementChild.cloneNode(true);
        const img = node.querySelector('.avatar');
        const name = node.querySelector('.name');
        const phone = node.querySelector('.phone');
        const pill = node.querySelector('.state');
        const del = node.querySelector('.del');

        img.src = m.avatarUrl || 'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect width=%2240%22 height=%2240%22 rx=%228%22 fill=%22%231b1b1d%22/><text x=%2250%25%22 y=%2255%25%22 text-anchor=%22middle%22 font-size=%2216%22 fill=%22%239aa0a6%22>üë§</text></svg>';
        name.textContent = m.name;
        phone.textContent = m.phone || '‚Äî';
        pill.textContent = m.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–°–∫—Ä—ã—Ç';
        pill.classList.add(m.isActive ? 'good' : 'bad');

        del.addEventListener('click', async () => {
          del.disabled = true;
          await fetch(`${API}/${m.id}`, { method: 'DELETE' });
          await fetchList();
        });

        listEl.appendChild(node);
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '–°–æ—Ö—Ä–∞–Ω—è—é‚Ä¶';
      const fd = new FormData(form);
      const payload = {
        name: fd.get('name')?.toString().trim(),
        phone: fd.get('phone')?.toString().trim(),
        avatarUrl: fd.get('avatarUrl')?.toString().trim(),
        isActive: document.getElementById('isActive').checked
      };
      try {
        const r = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!r.ok) throw new Error('bad status ' + r.status);
        statusEl.textContent = '–ì–æ—Ç–æ–≤–æ ‚úì';
        form.reset();
        document.getElementById('isActive').checked = true;
        await fetchList();
      } catch (err) {
        statusEl.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
      }
    });

    resetBtn.addEventListener('click', () => {
      form.reset();
      document.getElementById('isActive').checked = true;
      statusEl.textContent = '';
    });

    fetchList();
  </script>
</body>
</html>
